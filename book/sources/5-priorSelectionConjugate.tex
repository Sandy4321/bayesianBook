% !TEX root = ../script.tex


\section{Сопряженное априорное распределение}
\index{распределение!априорное!сопряженное}

\subsection{Определение сопряженного априорного распределения}

Одним из наиболее широко используемых понятий в Байесовской статистике является понятие сопряженного априорного распределения.

\begin{Definition}
Пусть задана статистическая модель данных с правдоподобием данных $p(X | \vecT)$.
Тогда семейство априорных распределений называется \emph{сопряженным семейством априорных распределений}, если 
при выборе априорного распределения из этого семейства,
апостериорное распределение тоже будет ему принадлежать.
\end{Definition}

Часто для краткости мы будем говорить не о сопряженном семействе априорных распределений, а просто о сопряженном априорном распределении.

\begin{example}
Тривиальный пример сопряженного семейства априорных распределений --- семейство всех вероятностных распределений.
\end{example}

Если смотреть на этот пример, не очень понятно, зачем нужно такое определение.
Однако во многих случаях определение такого семейства 
для заданной вероятностной модели оказывается полезным.

\subsection{Сопряженное распределение для мультиномиального распределения}

Рассмотрим выборку размера $\sS$ из мультиномиального распределения.
Пускай в этом распределении $k$ различных категорий, обозначим их $\{1, 2, \ldots, k\}$.
Обозначим $x_i$ количество наблюдений $i$-ой категории, 
а $\theta_i$ --- вероятность того, что мы наблюдаем событие из $i$-ой категории.
Тогда правдоподобие для наблюдений $\vecX = \{x_1, \ldots, x_k\}$ и вектора параметров $\vecT = \{\theta_1, \ldots, \theta_k\}$имеет вид:
\[
p(\vecX | \vecT) = C_{\sS}^{x_1, \ldots, x_k} \theta_1^{x_1} \cdot \ldots \cdot \theta_k^{x_k},
\]
где нормировочный коэффициент для распределения $C_{\sS}^{x_1, \ldots, x_k}$ имеет вид:
\[
C_{\sS}^{x_1, \ldots, x_k} = \frac{x_1! \ldots x_k!}{\sS!}.
\]

Пускай априорное распределение --- распределение Дирихле с вектором параметров $\vecA \in \bbR_+^k (\alpha_i \geq 0)$:
\[
\pi(\vecT | \vecA) \propto \theta_1^{\alpha_1 - 1} \cdot \ldots \cdot \theta_k^{\alpha_k - 1}.
\]
Тогда апостериорное распределение тоже будет распределением Дирихле с вектором параметров $\vecX + \vecA$:
\[
p(\vecT | \vecX, \vecA) \propto \theta_1^{x_1 + \alpha_1 - 1} \cdot \ldots \cdot \theta_k^{x_k + \alpha_k - 1}.
\]

Так как распределение Дирихле для категориальных случайных величин примерно то же самое, что и нормальное распределение для непрерывных случайных величин: для него все можно посчитать аналитически, и, кроме того, у него множество других полезных свойств, то его использование в этом случае в 
качестве сопряженного распределения представляется крайне полезным.



\subsection{Сопряженное распределение для экспоненциального семейства распределений}
\index{экспоненциальное семейство распределений}
% https://people.eecs.berkeley.edu/~jordan/courses/260-spring10/other-readings/chapter9.pdf
Экспоненциальное семейство распределений и его свойства описаны в разделе~\ref{sec:exp_family}.

Если $x_1, \ldots, x_\sS$ --- независимые одинаково распределенные случайные величины из одного и того же распределения из экспоненциального семейства, то
\[
p(X | \vecT) = \prod_{j = 1}^{\sS} h(\vecX_j) \exp \left(\vecT^\T \sum_{j = 1}^\sS T(\vecX_j) - n A(\vecT) \right).
\]

Определим сопряженное априорное распределение для экспоненциального семейства как
\[
\pi(\vecT | \vecTau, \sS_0) = H(\tau, \sS_0) \exp(\vecTau^\T \vecT - \sS_0 A(\vecT)).
\]
Это распределение тоже лежит в экспоненциальном семействе.
Апостериорное распределение будет иметь такой же вид, 
но с параметрами 
\[
\vecTau' = \vecTau + \sum_{j = 1}^\sS T(\vecX_j), \sS'_0 = \sS + \sS_0.
\]

В таблице приведены пары априорное распределение-правдоподобие.

Определим теперь $\vecMu = \vecMu(\vecT) = \bbE [T(\vecX) | \vecT]$.
Из общей теории экспоненциального семейства распределений 
следует, что $\vecMu = \nabla_{\vecT} A(\vecT)$.
Найдем среднее значение $\vecMu$ при фиксированном априорном распределении с параметрами $\vecTau$ и $\sS_0$.

Заметим сперва, что 
\[
\bbE [\vecMu | \vecTau, \sS_0] = \bbE [\nabla_{\vecT} A(\vecT) | \vecTau, \sS_0].
\]
С помощью прямых вычислений получим, что
\[
\nabla_{\vecT} \pi(\vecT| \vecTau, \sS_0) = \pi(\vecT| \vecTau, \sS_0) (\vecTau - \sS_0 \nabla_{\vecT} A(\vecT)).
\]
Так как $\pi(\vecT| \vecTau, \sS_0)$ --- плотность вероятностного распределения, то она обращается в ноль в бесконечности.
Тогда согласно теореме Грина:
\[
\int \pi(\vecT| \vecTau, \sS_0) (\vecTau - \sS_0 \nabla_{\vecT} A(\vecT)) d\vecT =
\int_{\bbR^\pD} \nabla_{\vecT} \pi(\vecT| \vecTau, \sS_0) d\vecT = 0.
\]
Следовательно, 
\[
\bbE [\vecMu | \vecTau, \sS_0] = \bbE [\nabla_{\vecT} A(\vecT) | \vecTau, \sS_0] = \frac{\vecTau}{\sS_0}.
\]
Аналогично для апостериорного распределения:
\[
\bbE [\vecMu | \vecTau, \sS_0] = \frac{\vecTau + \sum_{j = 1}^\sS T(\vecX_j)}{\sS + \sS_0} = \kappa \frac{\vecTau}{\sS_0} + (1 - \kappa) \frac{\sum_{j = 1}^\sS T(\vecX_j)}{\sS},
\]
где $\kappa = \frac{\sS_0}{\sS_0 + \sS}$.
Таким образом, апостериорное среднее --- линейная комбинация априорного среднего и среднего достаточных статистик.

Отметим, что при естественных предположениях выполнено и обратно утверждение:
если апостериорное среднее всегда выпуклая комбинация оценки максимума правдоподобия и априорного среднего,
то мы работаем с распределениями из экспоненциального семейства.


% Hайдем теперь $\bbE [\mu | \vecTau, \sS_0]$
% У экспоненциального семейства распределений множество замечательных свойств. 
% Мы лишь напомним, что $T(\vecX)$ --- вектор достаточных статистик для распределения, а для градиента $A(\vecT)$ выполнено, что:
% \[
% \nabla_{\vecT} A(\vecT) = \bbE (T(\vecX) | \vecT).
% \]





